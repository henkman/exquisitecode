<!DOCTYPE html>
<html>
<head>
	<title>Exquisite</title>
	<link rel="stylesheet" href="/highlight_obsidian.css">
	<script type="text/javascript" src="/highlight.pack.js"></script>
	<script type="text/javascript">
	/*
		window.onbeforeunload = function (e) {
			var message = "You leave the game if you leave this page.",
			e = e || window.event;
			if (e) {
				e.returnValue = message;
			}
			return message;
		};
	
	*/
	var socket;
	window.onload = function(e) {
		socket = new WebSocket("ws://localhost:8080/gamesock/{{.Game.Id}}");
		socket.onopen = function() {
			console.log("we are open");
			// socket.send("ping");
		}
		socket.onmessage = function(msg) {
			console.log(msg);
			// code.text = code.text + msg;
			// socket.send("ping");
		}
	};
	function submitAddline(form) {
		var line = form["line"].value;
		socket.send(line);
		return false;
	}
	</script>
	<style type="text/css">
		html, body{
			height:100%;
			margin:0;
		}
		.game {
			width: 100%;
			height:100%;
			background-color: darkslategrey;	
			overflow: hidden;
			color: #e0e2e4;
		}
		.left {
			float: left;
			background-color:#282b2e;
			padding-top:4px;
			padding-left:4px;
		}
		.right {
			overflow:hidden;
			padding-left:15px;
			padding-top:30px;
			margin-right:10px;
		}
		.clear:after {
			content:'';
    		display:block;
			clear:both;
		}
		.playerlist {
			padding:8px;
		}
		.task {
			padding: 4px;
			background-color: #670808;
		}
		code, #line {
			width:100%;
		}
	</style>
</head>
<body>
	<div class="game clear">
		<div class="left">
			<div>
				Logout?<br/>
				Options?<br/>
				Back to Index?<br/>
			</div>
			<hr/>
			<div class="playerlist">
				Players:
				<ul >
					{{range .Game.Players}}
					<li>{{.Name}}</li>
					{{end}}
				</ul>
			</div>
			<hr/>
			<div>
				Chat?
			</div>
		</div>
		<div class="right">
			<div class="task">
				{{.Game.Task.Description}}
			</div>
			<pre><code class="javascript hljs">{{.Game.Code}}</code></pre>
			<div>
				<form name="addline" action="/addline" action="post" onsubmit="return submitAddline(this)">
					<input type="text" id="line" name="line" value=""/>
				</form>
			</div>
			<div>
				{{.Game.Result}}
			</div>
		</div>
	</div>
</body>
</html>